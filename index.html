<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funeral Program Builder - Create Beautiful Memorial Programs</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600&family=Crimson+Text:wght@400;600&family=Cormorant+Garamond:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        * {
            font-family: 'Noto Sans', sans-serif;
        }
        
        body {
            overflow-x: hidden;
        }
        
        /* Sticky Navigation */
        .navbar {
            position: sticky;
            top: 0;
            z-index: 1000;
            background-color: #000 !important;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .navbar-brand {
            font-weight: 600;
            font-size: 1.3rem;
            color: #fff !important;
        }
        
        .nav-link {
            color: #fff !important;
            margin: 0 0.5rem;
            font-weight: 400;
            transition: opacity 0.3s;
        }
        
        .nav-link:hover {
            opacity: 0.7;
        }
        
        /* Section Styling */
        .section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding: 100px 0;
        }
        
        .section-black {
            background-color: #000;
            color: #fff;
        }
        
        .section-white {
            background-color: #fff;
            color: #000;
        }
        
        /* Hero Section */
        #hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), 
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><rect fill="%23000000" width="1200" height="800"/><g fill="%23ffffff" opacity="0.05"><circle cx="200" cy="200" r="100"/><circle cx="1000" cy="600" r="150"/><circle cx="600" cy="400" r="80"/></g></svg>');
            background-size: cover;
            background-position: center;
        }
        
        #hero h1 {
            font-size: 3.5rem;
            font-weight: 300;
            margin-bottom: 1.5rem;
            letter-spacing: -1px;
        }
        
        #hero p {
            font-size: 1.3rem;
            font-weight: 300;
            margin-bottom: 3rem;
            opacity: 0.9;
        }
        
        /* Buttons */
        .btn-primary-custom {
            background-color: #fff;
            color: #000;
            border: 2px solid #fff;
            padding: 15px 50px;
            font-size: 1.1rem;
            font-weight: 500;
            border-radius: 0;
            transition: all 0.3s;
        }
        
        .btn-primary-custom:hover {
            background-color: transparent;
            color: #fff;
        }
        
        .btn-secondary-custom {
            background-color: #000;
            color: #fff;
            border: 2px solid #000;
            padding: 15px 50px;
            font-size: 1.1rem;
            font-weight: 500;
            border-radius: 0;
            transition: all 0.3s;
        }
        
        .btn-secondary-custom:hover {
            background-color: transparent;
            color: #000;
            border-color: #000;
        }
        
        /* Form Sections */
        .form-section {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .form-section h2 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 1rem;
        }
        
        .form-section h3 {
            font-size: 1.8rem;
            font-weight: 400;
            margin-bottom: 2rem;
        }
        
        .form-label {
            font-weight: 500;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }
        
        .form-control, .form-select {
            border-radius: 0;
            padding: 12px;
            font-size: 1rem;
            border: 2px solid #ddd;
        }
        
        .section-black .form-control,
        .section-black .form-select {
            background-color: #1a1a1a;
            border-color: #444;
            color: #fff;
        }
        
        .section-black .form-control::placeholder {
            color: #999;
        }
        
        .section-black .form-control:focus,
        .section-black .form-select:focus {
            background-color: #1a1a1a;
            border-color: #fff;
            color: #fff;
        }
        
        .form-control:focus, .form-select:focus {
            box-shadow: none;
            border-color: #000;
        }
        
        /* Checkbox Styling */
        .form-check-input {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 0;
            border: 2px solid #ddd;
        }
        
        .section-black .form-check-input {
            border-color: #666;
            background-color: #1a1a1a;
        }
        
        .form-check-label {
            margin-left: 0.5rem;
            font-size: 1.1rem;
        }
        
        /* Enhanced Style Cards with Realistic Previews */
        .style-card {
            border: 3px solid #ddd;
            padding: 0;
            cursor: pointer;
            transition: all 0.4s ease;
            margin-bottom: 1.5rem;
            overflow: hidden;
            position: relative;
            background: #fff;
        }
        
        .section-black .style-card {
            border-color: #444;
            background: #1a1a1a;
        }
        
        .style-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .section-black .style-card:hover {
            border-color: #fff;
            box-shadow: 0 15px 40px rgba(255,255,255,0.15);
        }
        
        .section-white .style-card:hover {
            border-color: #000;
        }
        
        .style-card.selected {
            border-color: #000;
            border-width: 4px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .section-black .style-card.selected {
            border-color: #fff;
            box-shadow: 0 10px 30px rgba(255,255,255,0.2);
        }
        
        .style-card-preview {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
            font-size: 0.85rem;
            position: relative;
            overflow: hidden;
        }
        
        .style-card-info {
            padding: 1.5rem;
            background: #fff;
        }
        
        .section-black .style-card-info {
            background: #1a1a1a;
        }
        
        /* CLASSIC THEME PREVIEW - Rich, ornate, traditional */
        .preview-classic {
            background: linear-gradient(135deg, #f5f0e8 0%, #e8dcc8 100%);
            font-family: 'Playfair Display', serif;
            color: #2c1810;
            border: 8px double #8b7355;
            position: relative;
        }
        
        .preview-classic::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            border: 2px solid #c9a876;
            pointer-events: none;
        }
        
        .preview-classic .preview-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }
        
        .preview-classic .ornament {
            font-size: 2rem;
            color: #c9a876;
            margin: 10px 0;
        }
        
        .preview-classic h3 {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 15px 0 10px;
            color: #2c1810;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 3px double #8b7355;
            padding-bottom: 10px;
        }
        
        .preview-classic p {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #4a3728;
            font-style: italic;
        }
        
        /* MODERN THEME PREVIEW - Clean, contemporary, bold */
        .preview-modern {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            font-family: 'Montserrat', sans-serif;
            color: #000;
            position: relative;
            overflow: hidden;
        }
        
        .preview-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 8px;
            height: 100%;
            background: linear-gradient(180deg, #000 0%, #666 50%, #000 100%);
        }
        
        .preview-modern .preview-content {
            padding-left: 20px;
        }
        
        .preview-modern h3 {
            font-size: 1.6rem;
            font-weight: 300;
            letter-spacing: 8px;
            text-transform: uppercase;
            margin: 20px 0 5px;
            color: #000;
        }
        
        .preview-modern .subtitle {
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: 4px;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 20px;
        }
        
        .preview-modern p {
            font-size: 0.85rem;
            line-height: 2;
            font-weight: 300;
            color: #333;
        }
        
        .preview-modern .geometric {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border: 3px solid #000;
            transform: rotate(45deg);
        }
        
        /* RELIGIOUS THEME PREVIEW - Sacred, peaceful, reverent */
        .preview-religious {
            background: linear-gradient(to bottom, #fdfcfb 0%, #f7f5f2 100%);
            font-family: 'Crimson Text', serif;
            text-align: center;
            color: #3a3a3a;
            position: relative;
        }
        
        .preview-religious .preview-content {
            position: relative;
            z-index: 1;
        }
        
        .preview-religious .cross {
            font-size: 3rem;
            color: #b8956a;
            margin: 15px 0;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        
        .preview-religious h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 15px 0;
            color: #2a2a2a;
            letter-spacing: 1px;
        }
        
        .preview-religious .scripture {
            font-size: 0.85rem;
            font-style: italic;
            line-height: 1.8;
            color: #5a5a5a;
            padding: 15px;
            border-left: 3px solid #b8956a;
            border-right: 3px solid #b8956a;
            background: rgba(184, 149, 106, 0.05);
            margin: 15px 0;
        }
        
        .preview-religious .dove {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            opacity: 0.3;
        }
        
        /* MINIMAL THEME PREVIEW - Simple, elegant, essential */
        .preview-minimal {
            background: #ffffff;
            font-family: 'Noto Sans', sans-serif;
            color: #000;
            position: relative;
        }
        
        .preview-minimal .preview-content {
            padding: 40px 20px;
        }
        
        .preview-minimal h3 {
            font-size: 1.2rem;
            font-weight: 300;
            letter-spacing: 3px;
            margin: 0 0 30px;
            color: #000;
            position: relative;
            padding-bottom: 15px;
        }
        
        .preview-minimal h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 1px;
            background: #000;
        }
        
        .preview-minimal p {
            font-size: 0.8rem;
            line-height: 2.2;
            font-weight: 300;
            color: #666;
            margin: 0;
        }
        
        .preview-minimal .minimal-dot {
            width: 4px;
            height: 4px;
            background: #000;
            border-radius: 50%;
            margin: 20px auto 0;
        }
        
        /* Mood Card Styles */
        .mood-peaceful {
            font-family: 'Crimson Text', serif;
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
            color: #006064;
        }
        
        .section-black .mood-peaceful {
            background: linear-gradient(135deg, #1a3a3f 0%, #2d5559 100%);
            color: #b2ebf2;
        }
        
        .mood-celebration {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            color: #f57f17;
        }
        
        .section-black .mood-celebration {
            background: linear-gradient(135deg, #3d3416 0%, #5a4a1f 100%);
            color: #fff59d;
        }
        
        .mood-formal {
            font-family: 'Playfair Display', serif;
            background: linear-gradient(135deg, #e8e8e8 0%, #d0d0d0 100%);
            color: #212121;
        }
        
        .section-black .mood-formal {
            background: linear-gradient(135deg, #2a2a2a 0%, #3d3d3d 100%);
            color: #e8e8e8;
        }
        
        /* Color Swatches */
        .color-swatch {
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        
        .swatch-soft {
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 50%, #e1bee7 100%);
        }
        
        .swatch-dark {
            background: linear-gradient(135deg, #212121 0%, #424242 50%, #616161 100%);
        }
        
        .swatch-neutral {
            background: linear-gradient(135deg, #ffffff 0%, #e0e0e0 50%, #000000 100%);
        }
        
        /* File Upload */
        .file-upload-area {
            border: 2px dashed #ddd;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }
        
        .section-black .file-upload-area {
            border-color: #666;
            background: #1a1a1a;
        }
        
        .file-upload-area:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }
        
        .section-black .file-upload-area:hover {
            background-color: #2a2a2a;
            border-color: #fff;
        }
        
        #photoPreview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .photo-preview-item {
            position: relative;
            width: 150px;
            height: 150px;
        }
        
        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border: 2px solid #ddd;
        }
        
        .photo-preview-item .remove-photo {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #000;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 14px;
            line-height: 1;
        }
        
        /* Step Indicator */
        .step-indicator {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .step-number {
            display: inline-block;
            width: 50px;
            height: 50px;
            line-height: 50px;
            border-radius: 50%;
            background-color: #fff;
            color: #000;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .section-white .step-number {
            background-color: #000;
            color: #fff;
        }
        
        /* Loading Animation */
        .loading-dots {
            display: inline-block;
        }
        
        .loading-dots span {
            animation: blink 1.4s infinite;
            font-size: 2rem;
        }
        
        .loading-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .loading-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes blink {
            0%, 80%, 100% { opacity: 0; }
            40% { opacity: 1; }
        }
        
        /* Program Preview Container */
        .program-preview-wrapper {
            background: #f5f5f5;
            padding: 40px;
            border-radius: 10px;
        }
        
        /* Template Styles for Generated Programs */
        .program-preview {
            background: #fff;
            color: #000;
            padding: 60px 40px;
            max-width: 800px;
            margin: 0 auto;
            min-height: auto !important;
            box-shadow: none !important;
        }
        
        /* Classic Template */
        .template-classic {
            font-family: 'Playfair Display', serif;
            border: 5px double #333;
            padding: 60px;
            background: #fafafa;
        }
        
        .template-classic h1 {
            font-size: 2.5rem;
            border-bottom: 3px solid #333;
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-weight: 600;
        }
        
        .template-classic h4 {
            font-size: 1.5rem;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
            border-bottom: 1px solid #666;
            padding-bottom: 10px;
        }
        
        .template-classic .photo-main {
            border: 8px solid #333;
            margin: 30px auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .template-classic .decorative-line {
            border-top: 2px solid #333;
            margin: 20px 0;
        }
        
        /* Modern Template */
        .template-modern {
            font-family: 'Montserrat', sans-serif;
            background: #fff;
            padding: 60px;
        }
        
        .template-modern h1 {
            font-size: 3rem;
            font-weight: 300;
            letter-spacing: 5px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        
        .template-modern h4 {
            font-size: 1.2rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 40px;
            margin-bottom: 20px;
        }
        
        .template-modern .photo-main {
            border-radius: 0;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            margin: 40px auto;
        }
        
        .template-modern p {
            font-weight: 300;
            line-height: 1.8;
        }
        
        /* Religious Template */
        .template-religious {
            font-family: 'Crimson Text', serif;
            text-align: center;
            background: #fefefe;
            padding: 60px;
        }
        
        .template-religious h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .template-religious h4 {
            font-size: 1.6rem;
            margin-top: 30px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .template-religious .cross-symbol {
            font-size: 4rem;
            margin: 30px 0;
            color: #666;
        }
        
        .template-religious .photo-main {
            margin: 40px auto;
            border: 5px solid #d4af37;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .template-religious .scripture {
            font-style: italic;
            margin: 30px 0;
            padding: 20px;
            border-left: 3px solid #d4af37;
            border-right: 3px solid #d4af37;
            background: #f9f9f9;
        }
        
        /* Minimal Template */
        .template-minimal {
            font-family: 'Noto Sans', sans-serif;
            font-weight: 300;
            background: #fff;
            padding: 80px 60px;
        }
        
        .template-minimal h1 {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 40px;
            letter-spacing: 1px;
        }
        
        .template-minimal h4 {
            font-size: 1rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-top: 50px;
            margin-bottom: 20px;
            color: #666;
        }
        
        .template-minimal .photo-main {
            margin: 60px auto;
            filter: grayscale(20%);
        }
        
        .template-minimal p {
            line-height: 2;
            color: #555;
        }
        
        /* Photo Layouts */
        .photo-main {
            display: block;
            max-width: 350px;
            width: 100%;
            height: auto;
            margin: 30px auto;
        }
        
        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        
        .photo-gallery img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        
        /* Color Schemes */
        .color-soft {
            background: linear-gradient(to bottom, #fce4ec 0%, #f8bbd0 100%);
            color: #880e4f;
        }
        
        .color-soft h1, .color-soft h4 {
            color: #880e4f;
        }
        
        .color-dark {
            background: #1a1a1a;
            color: #e0e0e0;
        }
        
        .color-dark h1, .color-dark h4 {
            color: #fff;
        }
        
        .color-neutral {
            background: #fff;
            color: #000;
        }
        
        /* Editable Content */
        [contenteditable="true"] {
            outline:none !important;
            transition: outline 0.3s;
            padding: 8px;
            border-radius: 3px;
        }
        
        [contenteditable="true"]:hover {
            outline-color: #007bff;
            background: transparent !important;
        }
        
        [contenteditable="true"]:focus {
            outline-color: #0056b3;
            background-color: rgba(0, 123, 255, 0.1);
        }
        
        /* Selection Badge */
        .selected-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #000;
            color: #fff;
            padding: 8px 20px;
            font-size: 0.85rem;
            font-weight: 600;
            border-radius: 25px;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .section-black .selected-badge {
            background: #fff;
            color: #000;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            #hero h1 {
                font-size: 2.5rem;
            }
            
            #hero p {
                font-size: 1.1rem;
            }
            
            .form-section h2 {
                font-size: 2rem;
            }
            
            .program-preview {
                padding: 30px 20px;
            }
            
            .style-card-preview {
                height: 250px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- Sticky Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#hero">Memorial Program Builder</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#hero">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#step1">Get Started</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#step5">Preview</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section - BLACK -->
    <section id="hero" class="section section-black">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h1>We'll help you create a beautiful<br>funeral program in minutes.</h1>
                    <p>A respectful, simple way to honor your loved one's memory</p>
                    <button class="btn btn-primary-custom" onclick="scrollToSection('step1')">Create a Program</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Step 1: Basic Information - WHITE -->
    <section id="step1" class="section section-white">
        <div class="container">
            <div class="form-section">
                <div class="step-indicator">
                    <div class="step-number">1</div>
                    <h2>Basic Information</h2>
                    <p class="lead">Let's start with the essentials. Take your time.</p>
                </div>
                
                <form id="basicInfoForm">
                    <!-- Name Input -->
                    <div class="mb-4">
                        <label for="deceasedName" class="form-label">Full Name of Deceased *</label>
                        <input type="text" class="form-control" id="deceasedName" required placeholder="John Michael Smith">
                    </div>
                    
                    <!-- Dates -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="birthDate" class="form-label">Birth Date *</label>
                            <input type="date" class="form-control" id="birthDate" required>
                        </div>
                        <div class="col-md-6">
                            <label for="deathDate" class="form-label">Death Date *</label>
                            <input type="date" class="form-control" id="deathDate" required>
                        </div>
                    </div>
                    
                    <!-- Photo Upload -->
                    <div class="mb-5">
                        <label class="form-label">Upload Photos *</label>
                        <div class="file-upload-area" onclick="document.getElementById('photoInput').click()">
                            <input type="file" id="photoInput" multiple accept="image/*" style="display: none;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-cloud-upload mb-3" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z"/>
                                <path fill-rule="evenodd" d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3z"/>
                            </svg>
                            <p class="mb-0"><strong>Click to upload photos of your loved one</strong></p>
                            <small class="text-muted">You can upload multiple photos</small>
                        </div>
                        <div id="photoPreview" class="mt-3"></div>
                    </div>

                    <!-- Description -->
                    <div class="mb-5">
                        <label for="description" class="form-label">Tell us about their life, character, and legacy *</label>
                        <textarea class="form-control" id="description" rows="6" required placeholder="Share what made them special, their achievements, passions, and the impact they had on others..."></textarea>
                        <small class="text-muted">This will help us create meaningful content for the program</small>
                    </div>

                    <!-- Optional Sections -->
                    <div class="mb-5">
                        <label class="form-label d-block mb-3">What would you like to include? (Optional)</label>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="includeObituary" checked>
                                    <label class="form-check-label" for="includeObituary">Obituary</label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="includeService" checked>
                                    <label class="form-check-label" for="includeService">Order of Service</label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="includeHymns">
                                    <label class="form-check-label" for="includeHymns">Hymns / Songs</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="includePrayers">
                                    <label class="form-check-label" for="includePrayers">Prayers / Scriptures</label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="includeFamily" checked>
                                    <label class="form-check-label" for="includeFamily">Names of Family Members</label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="includeDetails" checked>
                                    <label class="form-check-label" for="includeDetails">Service Details</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Service Details (if checked) -->
                    <div id="serviceDetailsSection" class="mb-5">
                        <h4 class="mb-3">Service Details</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="serviceDate" class="form-label">Service Date</label>
                                <input type="date" class="form-control" id="serviceDate">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="serviceTime" class="form-label">Service Time</label>
                                <input type="time" class="form-control" id="serviceTime">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="serviceVenue" class="form-label">Venue</label>
                            <input type="text" class="form-control" id="serviceVenue" placeholder="St. Mary's Church, 123 Main Street">
                        </div>
                    </div>

                    <div class="text-center">
                        <button type="button" class="btn btn-secondary-custom" onclick="scrollToSection('step2')">Continue to Style Selection</button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Step 2: Style & Tone Selection - BLACK -->
    <section id="step2" class="section section-black">
        <div class="container">
            <div class="form-section">
                <div class="step-indicator">
                    <div class="step-number">2</div>
                    <h2>Style & Tone</h2>
                    <p class="lead">Choose the look and feel that honors their memory</p>
                </div>

                <form id="styleForm">
                    <!-- Theme Selection -->
                    <div class="mb-5">
                        <label class="form-label d-block mb-4" style="font-size: 1.3rem;">Choose Your Theme</label>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="style-card selected" data-theme="classic" onclick="selectTheme(this, 'classic')">
                                    <div class="style-card-preview preview-classic">
                                        <div class="preview-content">
                                            <div class="ornament">‚ùñ</div>
                                            <h3>In Memory</h3>
                                            <p>Traditional elegance<br>with timeless grace</p>
                                            <div class="ornament" style="font-size: 1.2rem;">‚ú¶ ‚ú¶ ‚ú¶</div>
                                        </div>
                                    </div>
                                    <div class="style-card-info">
                                        <h5 class="mb-2">Classic</h5>
                                        <p class="mb-0 small"><strong>Traditional and timeless.</strong> Features ornate borders, rich textures, elegant serif fonts, and formal symmetrical layouts that honor long-standing memorial traditions.</p>
                                    </div>
                                    <span class="selected-badge">Selected ‚úì</span>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="style-card" data-theme="modern" onclick="selectTheme(this, 'modern')">
                                    <div class="style-card-preview preview-modern">
                                        <div class="preview-content">
                                            <h3>MEMORY</h3>
                                            <div class="subtitle">CELEBRATING LIFE</div>
                                            <p>Clean lines.<br>Contemporary design.<br>Bold simplicity.</p>
                                            <div class="geometric"></div>
                                        </div>
                                    </div>
                                    <div class="style-card-info">
                                        <h5 class="mb-2">Modern</h5>
                                        <p class="mb-0 small"><strong>Clean and contemporary.</strong> Features minimalist layouts, sans-serif typography, bold geometric elements, and open spaces for a fresh, current aesthetic.</p>
                                    </div>
                                    <span class="selected-badge" style="display: none;">Selected ‚úì</span>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="style-card" data-theme="religious" onclick="selectTheme(this, 'religious')">
                                    <div class="style-card-preview preview-religious">
                                        <div class="preview-content">
                                            <div class="dove">üïäÔ∏è</div>
                                            <div class="cross">‚úù</div>
                                            <h3>Eternal Peace</h3>
                                            <div class="scripture">"I am the resurrection<br>and the life"</div>
                                        </div>
                                    </div>
                                    <div class="style-card-info">
                                        <h5 class="mb-2">Religious</h5>
                                        <p class="mb-0 small"><strong>Faith-centered and reverent.</strong> Incorporates sacred symbols, spiritual imagery, calming tones, and scripture elements to create a peaceful, devotional atmosphere.</p>
                                    </div>
                                    <span class="selected-badge" style="display: none;">Selected ‚úì</span>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="style-card" data-theme="minimal" onclick="selectTheme(this, 'minimal')">
                                    <div class="style-card-preview preview-minimal">
                                        <div class="preview-content">
                                            <h3>remembering</h3>
                                            <p>Simple elegance<br><br>Essential beauty<br><br>Quiet dignity</p>
                                            <div class="minimal-dot"></div>
                                        </div>
                                    </div>
                                    <div class="style-card-info">
                                        <h5 class="mb-2">Minimal</h5>
                                        <p class="mb-0 small"><strong>Refined simplicity.</strong> Features ample white space, limited color palette, light typography, and only essential elements for an understated, elegant tribute.</p>
                                    </div>
                                    <span class="selected-badge" style="display: none;">Selected ‚úì</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mood Selection -->
                    <div class="mb-5">
                        <label class="form-label d-block mb-3">Choose the Mood</label>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="style-card selected" data-mood="peaceful" onclick="selectMood(this, 'peaceful')">
                                    <div class="style-card-preview mood-peaceful">
                                        <div style="text-align: center;">
                                            <div style="font-size: 1.5rem; margin-bottom: 10px;">üïäÔ∏è</div>
                                            <div style="font-style: italic;">Peaceful</div>
                                        </div>
                                    </div>
                                    <div class="style-card-info">
                                        <h6 class="mb-1">Peaceful</h6>
                                        <p class="mb-0 small">Calm and serene tone</p>
                                    </div>
                                    <span class="selected-badge" style="display: none;">Selected ‚úì</span>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="style-card" data-mood="celebration" onclick="selectMood(this, 'celebration')">
                                    <div class="style-card-preview mood-celebration">
                                        <div style="text-align: center;">
                                            <div style="font-size: 1.5rem; margin-bottom: 10px;">üåü</div>
                                            <div style="font-weight: 500;">Celebration</div>
                                        </div>
                                    </div>
                                    <div class="style-card-info">
                                        <h6 class="mb-1">Celebration of Life</h6>
                                        <p class="mb-0 small">Joyful remembrance</p>
                                    </div>
                                    <span class="selected-badge" style="display: none;">Selected ‚úì</span>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="style-card" data-mood="formal" onclick="selectMood(this, 'formal')">
                                    <div class="style-card-preview mood-formal">
                                        <div style="text-align: center;">
                                            <div style="font-size: 1.5rem; margin-bottom: 10px;">üé©</div>
                                            <div style="font-weight: 600;">Formal</div>
                                        </div>
                                    </div>
                                    <div class="style-card-info">
                                        <h6 class="mb-1">Formal</h6>
                                        <p class="mb-0 small">Dignified and respectful</p>
                                    </div>
                                    <span class="selected-badge" style="display: none;">Selected ‚úì</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Color Scheme -->
                    <div class="mb-5">
                        <label class="form-label d-block mb-3">Choose Color Scheme</label>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="style-card" data-color="soft" onclick="selectColor(this, 'soft')">
                                    <div class="color-swatch swatch-soft"></div>
                                    <div class="style-card-info">
                                        <h6 class="mb-1">Soft</h6>
                                        <p class="mb-0 small">Gentle pastel tones</p>
                                    </div>
                                    <span class="selected-badge" style="display: none;">Selected ‚úì</span>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="style-card" data-color="dark" onclick="selectColor(this, 'dark')">
                                    <div class="color-swatch swatch-dark"></div>
                                    <div class="style-card-info">
                                        <h6 class="mb-1">Dark</h6>
                                        <p class="mb-0 small">Rich, deep tones</p>
                                    </div>
                                    <span class="selected-badge" style="display: none;">Selected ‚úì</span>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="style-card selected" data-color="neutral" onclick="selectColor(this, 'neutral')">
                                    <div class="color-swatch swatch-neutral"></div>
                                    <div class="style-card-info">
                                        <h6 class="mb-1">Neutral</h6>
                                        <p class="mb-0 small">Classic black & white</p>
                                    </div>
                                    <span class="selected-badge" style="display: none;">Selected ‚úì</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Preferences (What NOT to include) -->
                    <div class="mb-5">
                        <label class="form-label d-block mb-3">Preferences (What to avoid)</label>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="noReligious">
                                    <label class="form-check-label" for="noReligious">No religious language</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="noDarkColors">
                                    <label class="form-check-label" for="noDarkColors">No dark colors</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="noLongText">
                                    <label class="form-check-label" for="noLongText">No long text</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="text-center">
                        <button type="button" class="btn btn-primary-custom" onclick="generateProgram()">Generate Program</button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Step 3: AI Generation (Loading) - WHITE -->
    <section id="step3" class="section section-white" style="display: none;">
        <div class="container">
            <div class="form-section text-center">
                <div class="step-indicator">
                    <div class="step-number">3</div>
                    <h2>Creating Your Program</h2>
                </div>
                
                <div class="my-5">
                    <div class="spinner-border" role="status" style="width: 4rem; height: 4rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-4 lead">We're carefully crafting a beautiful memorial program<span class="loading-dots"><span>.</span><span>.</span><span>.</span></span></p>
                    <p class="text-muted" id="loadingStatus">Analyzing your inputs and generating content...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Step 4: Edit & Preview - BLACK -->
    <section id="step5" class="section section-black" style="display: none;">
        <div class="container">
            <div class="form-section">
                <div class="step-indicator">
                    <div class="step-number">4</div>
                    <h2>Review & Edit</h2>
                    <p class="lead">Click on any text to edit. Your changes will be saved in the PDF.</p>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="program-preview-wrapper">
                            <div id="programPreviewContainer" class="program-preview">
                                <!-- Generated content will be inserted here -->
                            </div>
                        </div>

                        <div class="text-center mt-5">
                            <button class="btn btn-primary-custom me-2" onclick="downloadPDF()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-download me-2" viewBox="0 0 16 16" style="vertical-align: middle;">
                                    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                    <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                                </svg>
                                Download PDF
                            </button>
                            <button class="btn btn-primary-custom" style="background-color: transparent; color: #fff;" onclick="regenerateFullProgram()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-clockwise me-2" viewBox="0 0 16 16" style="vertical-align: middle;">
                                    <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                                    <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                                </svg>
                                Regenerate All
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global state
        let appState = {
            photos: [],
            formData: {},
            selectedTheme: 'classic',
            selectedMood: 'peaceful',
            selectedColor: 'neutral',
            generatedContent: {}
        };

        // Photo upload handling
        document.getElementById('photoInput').addEventListener('change', function(e) {
            const preview = document.getElementById('photoPreview');
            
            for (let file of e.target.files) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoData = e.target.result;
                    appState.photos.push(photoData);
                    
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-preview-item';
                    photoItem.innerHTML = `
                        <img src="${photoData}" alt="Photo">
                        <button class="remove-photo" onclick="removePhoto(${appState.photos.length - 1})">√ó</button>
                    `;
                    preview.appendChild(photoItem);
                }
                reader.readAsDataURL(file);
            }
        });

        function removePhoto(index) {
            appState.photos.splice(index, 1);
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = '';
            appState.photos.forEach((photo, i) => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-preview-item';
                photoItem.innerHTML = `
                    <img src="${photo}" alt="Photo">
                    <button class="remove-photo" onclick="removePhoto(${i})">√ó</button>
                `;
                preview.appendChild(photoItem);
            });
        }

        // Style selection functions
        function selectTheme(element, theme) {
            document.querySelectorAll('[data-theme]').forEach(el => {
                el.classList.remove('selected');
                el.querySelector('.selected-badge').style.display = 'none';
            });
            element.classList.add('selected');
            element.querySelector('.selected-badge').style.display = 'block';
            appState.selectedTheme = theme;
        }

        function selectMood(element, mood) {
            document.querySelectorAll('[data-mood]').forEach(el => {
                el.classList.remove('selected');
                el.querySelector('.selected-badge').style.display = 'none';
            });
            element.classList.add('selected');
            element.querySelector('.selected-badge').style.display = 'block';
            appState.selectedMood = mood;
        }

        function selectColor(element, color) {
            document.querySelectorAll('[data-color]').forEach(el => {
                el.classList.remove('selected');
                el.querySelector('.selected-badge').style.display = 'none';
            });
            element.classList.add('selected');
            element.querySelector('.selected-badge').style.display = 'block';
            appState.selectedColor = color;
        }

        // Initialize selected badges on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelector('[data-theme="classic"] .selected-badge').style.display = 'block';
            document.querySelector('[data-mood="peaceful"] .selected-badge').style.display = 'block';
            document.querySelector('[data-color="neutral"] .selected-badge').style.display = 'block';
        });

        // Smooth scroll
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Toggle service details
        document.getElementById('includeDetails').addEventListener('change', function(e) {
            document.getElementById('serviceDetailsSection').style.display = e.target.checked ? 'block' : 'none';
        });

        // Main program generation
        async function generateProgram() {
            // Validate required fields
            const name = document.getElementById('deceasedName').value.trim();
            const birthDate = document.getElementById('birthDate').value;
            const deathDate = document.getElementById('deathDate').value;
            const description = document.getElementById('description').value.trim();
            
            if (!name || !birthDate || !deathDate || !description) {
                alert('Please fill in all required fields (Name, Dates, Description)');
                return;
            }
            
            if (appState.photos.length === 0) {
                alert('Please upload at least one photo');
                return;
            }

            // Collect form data
            appState.formData = {
                name: name,
                birthDate: birthDate,
                deathDate: deathDate,
                description: description,
                includeObituary: document.getElementById('includeObituary').checked,
                includeService: document.getElementById('includeService').checked,
                includeHymns: document.getElementById('includeHymns').checked,
                includePrayers: document.getElementById('includePrayers').checked,
                includeFamily: document.getElementById('includeFamily').checked,
                includeDetails: document.getElementById('includeDetails').checked,
                serviceDate: document.getElementById('serviceDate').value,
                serviceTime: document.getElementById('serviceTime').value,
                serviceVenue: document.getElementById('serviceVenue').value,
                noReligious: document.getElementById('noReligious').checked,
                noDarkColors: document.getElementById('noDarkColors').checked,
                noLongText: document.getElementById('noLongText').checked
            };

            // Show loading section
            document.getElementById('step3').style.display = 'flex';
            scrollToSection('step3');

            // Generate content using smart templates
            await generateSmartContent();

            // Hide loading, show preview
            setTimeout(() => {
                document.getElementById('step3').style.display = 'none';
                document.getElementById('step5').style.display = 'flex';
                renderProgram();
                scrollToSection('step5');
            }, 2000);
        }

        // Smart template generation (no API needed)
        async function generateSmartContent() {
            document.getElementById('loadingStatus').textContent = 'Crafting your memorial program...';
            
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            const { name, birthDate, deathDate, description, noReligious, noLongText } = appState.formData;
            const mood = appState.selectedMood;
            
            // Calculate age
            const birth = new Date(birthDate);
            const death = new Date(deathDate);
            const age = death.getFullYear() - birth.getFullYear();
            
            // Generate obituary based on description and mood
            let obituaryIntro = '';
            if (mood === 'celebration') {
                obituaryIntro = `${name} lived a vibrant and meaningful life before passing on ${formatDate(deathDate)} at the age of ${age}. `;
            } else if (mood === 'formal') {
                obituaryIntro = `It is with deep respect that we announce the passing of ${name} on ${formatDate(deathDate)} at the age of ${age}. `;
            } else {
                obituaryIntro = `${name} passed peacefully on ${formatDate(deathDate)} at the age of ${age}, leaving behind cherished memories. `;
            }
            
            const obituaryBody = description;
            const obituaryEnd = noLongText 
                ? ` ${name} will be remembered with love and gratitude.`
                : ` ${name}'s legacy of kindness, dedication, and love will continue to inspire all who knew them. They touched countless lives and will be deeply missed but never forgotten.`;
            
            appState.generatedContent.obituary = obituaryIntro + obituaryBody + obituaryEnd;
            
            // Generate order of service
            let serviceItems = [];
            if (!noReligious) {
                serviceItems = [
                    'Opening Prayer',
                    'Scripture Reading',
                    'Hymn: "Amazing Grace"',
                    'Eulogy',
                    'Musical Reflection',
                    'Closing Prayer',
                    'Benediction'
                ];
            } else {
                serviceItems = [
                    'Welcome and Opening Remarks',
                    'Musical Selection',
                    'Sharing of Memories',
                    'Eulogy',
                    'Moment of Reflection',
                    'Closing Remarks'
                ];
            }
            appState.generatedContent.service = serviceItems;
            
            // Generate hymns/songs
            if (!noReligious) {
                appState.generatedContent.hymns = [
                    'Amazing Grace',
                    'How Great Thou Art',
                    'The Old Rugged Cross',
                    'In the Garden'
                ];
            } else {
                appState.generatedContent.hymns = [
                    'What a Wonderful World',
                    'Somewhere Over the Rainbow',
                    'Time to Say Goodbye'
                ];
            }
            
            // Generate prayers
            if (!noReligious) {
                appState.generatedContent.prayers = [
                    "The Lord's Prayer",
                    "Prayer of Comfort",
                    "Psalm 23"
                ];
            } else {
                appState.generatedContent.prayers = null;
            }
            
            // Generate family section
            appState.generatedContent.family = `${name} is survived by a loving family who will forever cherish their memory. Family details will be shared during the service.`;
        }

        // Render the program preview
        function renderProgram() {
            const container = document.getElementById('programPreviewContainer');
            const { name, birthDate, deathDate } = appState.formData;
            const content = appState.generatedContent;
            
            // Get template class
            const templateClass = `template-${appState.selectedTheme}`;
            const colorClass = `color-${appState.selectedColor}`;
            
            // Build photo HTML
            let photoHTML = '';
            if (appState.photos.length > 0) {
                photoHTML += `<img src="${appState.photos[0]}" alt="${name}" class="photo-main">`;
                
                if (appState.photos.length > 1) {
                    photoHTML += '<div class="photo-gallery">';
                    for (let i = 1; i < appState.photos.length && i < 5; i++) {
                        photoHTML += `<img src="${appState.photos[i]}" alt="${name}">`;
                    }
                    photoHTML += '</div>';
                }
            }
            
            // Build sections based on user selections
            let sectionsHTML = '';
            
            if (appState.formData.includeObituary && content.obituary) {
                sectionsHTML += `
                    <div class="mb-5">
                        <h4>Life Story</h4>
                        <p contenteditable="true" class="editable-content">${content.obituary}</p>
                    </div>
                `;
            }
            
            if (appState.formData.includeService && content.service) {
                sectionsHTML += `
                    <div class="mb-5">
                        <h4>Order of Service</h4>
                        <ul class="list-unstyled" style="line-height: 2;">
                            ${content.service.map(item => `<li class="mb-2">‚Ä¢ ${item}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            if (appState.formData.includeHymns && content.hymns) {
                sectionsHTML += `
                    <div class="mb-5">
                        <h4>${appState.formData.noReligious ? 'Musical Selections' : 'Hymns'}</h4>
                        <ul class="list-unstyled">
                            ${content.hymns.map(hymn => `<li class="mb-2">‚Ä¢ ${hymn}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            if (appState.formData.includePrayers && content.prayers) {
                sectionsHTML += `
                    <div class="mb-5">
                        <h4>Prayers & Scriptures</h4>
                        <ul class="list-unstyled">
                            ${content.prayers.map(prayer => `<li class="mb-2">‚Ä¢ ${prayer}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            if (appState.formData.includeFamily && content.family) {
                sectionsHTML += `
                    <div class="mb-5">
                        <h4>Family</h4>
                        <p contenteditable="true" class="editable-content">${content.family}</p>
                    </div>
                `;
            }
            
            let detailsHTML = '';
            if (appState.formData.includeDetails && appState.formData.serviceVenue) {
                detailsHTML = `
                    <div class="text-center mt-5 pt-5" style="border-top: 2px solid currentColor;">
                        <p style="font-weight: 600; font-size: 1.1rem; margin-bottom: 15px;">Service Information</p>
                        <p style="line-height: 1.8;">
                            ${appState.formData.serviceDate ? formatDate(appState.formData.serviceDate) : ''}<br>
                            ${appState.formData.serviceTime ? formatTime(appState.formData.serviceTime) : ''}<br>
                            ${appState.formData.serviceVenue || ''}
                        </p>
                    </div>
                `;
            }
            
            // Religious symbol for religious template
            const religiousSymbol = appState.selectedTheme === 'religious' && !appState.formData.noReligious 
                ? '<div class="cross-symbol">‚úù</div>' 
                : '';
            
            // Decorative line for classic template
            const decorativeLine = appState.selectedTheme === 'classic' 
                ? '<div class="decorative-line"></div>' 
                : '';
            
            container.className = `program-preview ${templateClass} ${colorClass}`;
            container.innerHTML = `
                <div class="text-center mb-5">
                    ${religiousSymbol}
                    <h1>In Loving Memory</h1>
                    ${decorativeLine}
                    ${photoHTML}
                    <h2 style="font-size: 2rem; margin-top: 30px; margin-bottom: 10px;">${name}</h2>
                    <p style="font-size: 1.1rem; opacity: 0.8;">${formatDate(birthDate)} - ${formatDate(deathDate)}</p>
                </div>
                
                ${sectionsHTML}
                ${detailsHTML}
            `;
        }

        // Download PDF - FIXED TO SHOW CONTENT PROPERLY
        function downloadPDF() {
            const element = document.getElementById('programPreviewContainer');
            const filename = `funeral-program-${appState.formData.name.replace(/\s+/g, '-').toLowerCase()}.pdf`;
            
            // Show loading indicator
            const downloadBtn = event.target;
            const originalText = downloadBtn.innerHTML;
            downloadBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Generating PDF...';
            downloadBtn.disabled = true;

            // Create a clean clone for PDF generation
            const clone = element.cloneNode(true);
            
            // Remove contenteditable attributes
            clone.querySelectorAll('[contenteditable]').forEach(el => {
                el.removeAttribute('contenteditable');
                el.style.outline = 'none';
                el.style.border = 'none';

            });
            
            // Remove the wrapper box shadow for cleaner PDF
            clone.style.boxShadow = 'none';
            clone.style.maxWidth = '100%';
            clone.style.minHeight = 'auto';
            clone.style.display ='block';
            clone.style.position = 'relative';
            clone.style.width ='100%';
            clone.style.margin = '0 auto';
            clone.style.padding ='60px 40px';


            // PDF generation options
            const opt = {
                margin: [0.5, 0.5, 0.5, 0.5],
                filename: filename,
                image: { 
                    type: 'jpeg', 
                    quality: 0.95 
                },
                html2canvas: { 
                    scale: 2,
                    useCORS: true,
                    logging: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    scrollY : 0,
                    scrollX: 0,
                    windowWidth: 800,
                    width: 800,
                    x: 0 ,
                    y: 0,
                    onclone: function(clonedDoc){
                        const clonedElement = clonedDoc.getElementById('programPreviewContainer');
                        if (clonedElement) {
                         
                            clonedElement.style.minHeight = 'auto';
                            clonedElement.style.display ='block';
                            clonedElement.style.margin = '0 auto';
                            clonedElement.style.width ='100%';
                            clonedElement.style.maxWidth ='750px';
                            clonedElement.style.padding ='60px 40px';
                            clonedElement.style.boxSizing ='border-box';
                            
                            const wrapper = clonedElement.parentElement;
                            if (wrapper) {
                                wrapper.style.background = '#ffffff';
                                wrapper.style.padding = '0';
                            }
                        }
                    }
                    
                    
                },
                jsPDF: { 
                    unit: 'in', 
                    format: 'letter', 
                    orientation: 'portrait',
                    compress:true
                },
                pagebreak:{
                    mode:['avoid-all'],
                    before: '.page-break-before',
                    after: '.page-break-after',
                }
            };

            // Generate and download PDF
            html2pdf().set(opt).from(clone).save()
                .then(() => {
                    // Restore button
                    downloadBtn.innerHTML = originalText;
                    downloadBtn.disabled = false;
                    alert('Your PDF has been downloaded successfully!');
                })
                .catch(err => {
                    console.error('PDF generation error:', err);
                    alert('There was an issue generating the PDF. Please try again.');
                    
                    // Restore button
                    downloadBtn.innerHTML = originalText;
                    downloadBtn.disabled = false;
                });
        }

        // Regenerate full program
        function regenerateFullProgram() {
            if (confirm('This will regenerate the entire program with the same settings. Continue?')) {
                document.getElementById('step5').style.display = 'none';
                generateProgram();
            }
        }

        // Utility functions
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        function formatTime(timeStr) {
            if (!timeStr) return '';
            const [hours, minutes] = timeStr.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        // Active nav link on scroll
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav-link');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= (sectionTop - 200)) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>